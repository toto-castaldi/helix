---
phase: 11-image-auto-play-slideshow
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/live/components/ImageGallery.tsx
autonomous: false

must_haves:
  truths:
    - "Coach taps an exercise image with multiple Lumio images and images cycle automatically every 3 seconds, looping back to first after last"
    - "Coach taps image again while slideshow is playing and it stops on the current image"
    - "A persistent play/pause icon overlay is visible in the top-right corner indicating current state"
    - "Coach swipes manually during auto-play and slideshow stops automatically"
    - "Exercises with single image or no images show no auto-play affordance and behave exactly as before"
    - "Subtle amber glow/border visible around image container while auto-play is active"
  artifacts:
    - path: "src/live/components/ImageGallery.tsx"
      provides: "Auto-play slideshow with play/pause toggle, visual feedback, and gesture integration"
      contains: "setInterval.*3000"
  key_links:
    - from: "ImageGallery tap handler"
      to: "setInterval/clearInterval"
      via: "isPlaying state toggle"
      pattern: "isPlaying.*setIsPlaying"
    - from: "ImageGallery swipe handler"
      to: "auto-play stop"
      via: "handleTouchEnd clears interval on swipe detection"
      pattern: "setIsPlaying.*false"
---

<objective>
Add auto-play slideshow to the existing ImageGallery component. Coach can tap to start/stop automatic image cycling (3 sec interval, looping), with a persistent play/pause icon overlay in the top-right corner and a subtle amber glow border while playing. Manual swipe stops auto-play automatically.

Purpose: Coaches need hands-free image cycling during live sessions to demonstrate exercises without touching the tablet repeatedly.
Output: Modified ImageGallery.tsx with auto-play functionality fully integrated into existing swipe navigation.
</objective>

<execution_context>
@/home/toto/.claude/get-shit-done/workflows/execute-plan.md
@/home/toto/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@src/live/components/ImageGallery.tsx
@src/live/components/ExerciseCard.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add auto-play slideshow with play/pause overlay and amber glow to ImageGallery</name>
  <files>src/live/components/ImageGallery.tsx</files>
  <action>
Modify the existing ImageGallery component to add auto-play slideshow functionality. All changes are within this single file.

**New state and refs:**
- Add `isPlaying` boolean state (default false)
- Add `intervalRef` using useRef<ReturnType<typeof setInterval> | null>(null) to hold the interval ID

**Auto-play interval logic (useEffect):**
- When `isPlaying` becomes true AND `isMultiImage` is true, start a setInterval at 3000ms
- Each tick: advance `currentIndex` by 1. When at `images.length - 1`, wrap to 0 (loop). Use the same `setCurrentIndex` — this triggers the existing translateX CSS transition for a consistent forward-slide animation
- When `isPlaying` becomes false or component unmounts, clearInterval
- Cleanup function in useEffect must clearInterval on unmount
- Dependencies: `isPlaying`, `isMultiImage`, `images.length`
- IMPORTANT: Use functional updater `setCurrentIndex(prev => ...)` inside the interval callback so the interval closure doesn't capture stale `currentIndex`

**Tap-to-toggle handler:**
- Create `handleTap` callback that toggles `isPlaying` state
- Only active when `isMultiImage` is true — single-image exercises must have NO auto-play affordance at all
- Attach as `onClick` on the outer container div (the one with `className="relative overflow-hidden..."`)
- This works because the full image area is the tap target (per user decision)

**Gesture conflict — swipe stops auto-play (IMGAP-04):**
- In the existing `handleTouchEnd`, BEFORE processing swipe direction, check if a valid swipe occurred (distance > threshold). If yes AND `isPlaying` is true: call `setIsPlaying(false)` and ALSO honor the swipe direction (navigate to next/prev image). This gives the coach both behaviors: stop auto-play AND navigate. This is the "stop + navigate" discretion choice — most intuitive for a coach mid-demonstration.

**Dot indicator tap during auto-play (discretion choice):**
- When a dot is tapped during auto-play: jump to that image AND stop auto-play. The coach tapping a specific dot indicates intentional navigation, so stopping is appropriate. Add `setIsPlaying(false)` inside the existing dot `onClick` handler (only when `isPlaying` is true).

**Play/pause icon overlay (IMGAP-03):**
- Render a small persistent icon in the top-right corner of the image container, ONLY when `isMultiImage` is true
- Position: `absolute top-2 right-2` with `z-10`
- Icon: Use lucide-react `Play` icon when not playing, `Pause` icon when playing
- Style: white icon (`text-white`) with a semi-transparent dark background circle (`bg-black/50 rounded-full p-1`) for visibility on any image. Icon size: `w-5 h-5`
- The icon is purely decorative/indicator — tapping it also triggers the container onClick (event bubbles up), so no separate click handler needed
- Add `pointer-events-none` to the icon wrapper so it doesn't interfere with touch events

**Amber glow border while playing (user decision):**
- When `isPlaying` is true, add a subtle amber ring/border to the outer container div
- Use Tailwind: `ring-2 ring-amber-400/60` conditionally applied via `cn()` when `isPlaying && isMultiImage`
- This provides visual feedback that auto-play is active without being distracting

**Single-image / no-image guard (IMGAP-05):**
- The `isMultiImage` check gates ALL auto-play features: no interval, no tap handler, no overlay icon, no amber glow
- Single-image exercises continue to work exactly as before — the existing touch handlers already early-return when `!isMultiImage`

**Import additions:**
- Add `useEffect` to the React import (already has useState, useRef, useCallback)
- Add `Play, Pause` to lucide-react imports (add a new import line)
  </action>
  <verify>
Run `npm run build` and `npm run build:live` — both must succeed with zero TypeScript errors. Verify the file contains: isPlaying state, setInterval with 3000, Play/Pause imports, ring-amber-400, handleTap, and setIsPlaying(false) in handleTouchEnd.
  </verify>
  <done>
ImageGallery.tsx compiles cleanly. Auto-play logic, play/pause overlay, amber glow, swipe-stop, and dot-stop are all implemented. Single-image exercises are unaffected.
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Task 2: Verify auto-play on live tablet</name>
  <files>src/live/components/ImageGallery.tsx</files>
  <action>
Human verification of auto-play slideshow on live tablet. What was built:
- Tap to start/stop cycling (3 sec interval, loops)
- Play/pause icon in top-right corner
- Amber glow border while playing
- Swipe during auto-play stops it and navigates
- Dot tap during auto-play stops and jumps
- Single-image exercises unaffected
  </action>
  <verify>
1. Open live tablet at http://localhost:5174
2. Navigate to a date with sessions containing exercises that have multiple Lumio images
3. Swipe to an exercise with multiple images — verify play icon (triangle) visible in top-right corner
4. Tap the image area — verify:
   a. Images start cycling every ~3 seconds with slide animation
   b. Icon changes to pause (two vertical bars)
   c. Amber glow/ring appears around the image container
   d. After the last image, it loops back to the first with same slide animation
5. Tap the image again — verify:
   a. Slideshow stops on current image
   b. Icon changes back to play
   c. Amber glow disappears
6. Start auto-play again, then swipe left/right — verify:
   a. Auto-play stops immediately
   b. The swipe navigates to next/prev image
   c. Play icon shown, amber glow gone
7. Start auto-play, then tap a dot indicator — verify:
   a. Jumps to that image
   b. Auto-play stops
8. Navigate to an exercise with a single Lumio image — verify NO play icon, NO tap-to-autoplay behavior
9. Navigate to an exercise with no images (ImageOff placeholder) — verify no changes from before
  </verify>
  <done>All 9 verification steps pass on the live tablet. Auto-play works correctly for multi-image exercises and has zero impact on single-image or no-image exercises.</done>
  <resume-signal>Type "approved" or describe issues to fix</resume-signal>
</task>

</tasks>

<verification>
- `npm run build` passes (main app)
- `npm run build:live` passes (tablet app)
- All 5 requirements covered: IMGAP-01 (tap to start, 3s, loops), IMGAP-02 (tap to stop), IMGAP-03 (play/pause overlay), IMGAP-04 (swipe stops auto-play), IMGAP-05 (multi-image only)
- Human verification confirms all behaviors on live tablet
</verification>

<success_criteria>
- Coach can tap to start auto-play slideshow that cycles images every 3 seconds and loops
- Coach can tap again to stop
- Play/pause icon persistently visible in top-right corner for multi-image exercises
- Subtle amber glow while auto-play active
- Manual swipe stops auto-play and navigates
- Single-image and no-image exercises completely unaffected
</success_criteria>

<output>
After completion, create `.planning/phases/11-image-auto-play-slideshow/11-01-SUMMARY.md`
</output>
