---
phase: 15-deploy-pipeline
plan: 02
type: execute
wave: 2
depends_on: [15-01]
files_modified: []
autonomous: false
requirements: [INFRA-01, INFRA-03]

user_setup:
  - service: GitHub Actions
    why: "Landing app deploy path secret required for new pipeline step"
    env_vars:
      - name: DEPLOY_PATH_LANDING
        source: "GitHub repo Settings > Secrets and variables > Actions > New repository secret, value: /var/www/helix-landing"

must_haves:
  truths:
    - "A push to main builds and deploys all three apps without manual intervention"
    - "helix.toto-castaldi.com serves the landing page with valid HTTPS"
    - "coach.helix.toto-castaldi.com serves the coach app with valid HTTPS"
    - "live.helix.toto-castaldi.com serves the live tablet app with valid HTTPS"
  artifacts: []
  key_links:
    - from: "GitHub Actions workflow"
      to: "/var/www/helix-landing"
      via: "DEPLOY_PATH_LANDING secret"
      pattern: "DEPLOY_PATH_LANDING"
---

<objective>
User adds the DEPLOY_PATH_LANDING GitHub secret, triggers a deploy, and verifies all three domains work correctly.

Purpose: The pipeline update from Plan 15-01 requires a new GitHub Actions secret and end-to-end verification that all three apps build, deploy, and serve correctly over HTTPS.

Output: All three Helix domains serving current content via automated pipeline.
</objective>

<execution_context>
@/home/toto/.claude/get-shit-done/workflows/execute-plan.md
@/home/toto/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/15-deploy-pipeline/15-01-SUMMARY.md
</context>

<tasks>

<task type="checkpoint:human-action" gate="blocking">
  <name>Task 1: Add DEPLOY_PATH_LANDING GitHub secret and verify full pipeline</name>
  <files>N/A - GitHub UI action</files>
  <action>
The user must add a new GitHub Actions secret and then verify the complete pipeline works.

**Step 1: Add GitHub secret**
1. Go to GitHub repository Settings > Secrets and variables > Actions
2. Click "New repository secret"
3. Name: `DEPLOY_PATH_LANDING`
4. Value: `/var/www/helix-landing`
5. Click "Add secret"

**Step 2: Trigger and verify deploy**
1. Push to main (the plan execution commit will trigger it, or push manually)
2. Go to GitHub Actions tab and watch the workflow run
3. Verify ALL steps complete successfully, especially:
   - "Build landing app" step passes
   - "Deploy landing app to server" step passes
   - "Deploy Nginx configs to server" step passes
   - "Apply Nginx configs and reload" step passes
   - All existing steps (coach build/deploy, live build/deploy, Supabase) pass
4. After the workflow completes, verify the three domains:
   - Visit https://helix.toto-castaldi.com — should show the landing page
   - Visit https://coach.helix.toto-castaldi.com — should show the coach app login
   - Visit https://live.helix.toto-castaldi.com — should show the live tablet app
5. Verify HTTPS certificates are valid on all three domains (no browser warnings)
  </action>
  <verify>All three domains serve correct content over HTTPS after automated pipeline run</verify>
  <done>Push to main deploys landing, coach, and live apps automatically; all three domains accessible with valid HTTPS</done>
</task>

</tasks>

<verification>
1. GitHub Actions workflow run completes without errors
2. All three domains serve their correct content over HTTPS
3. No manual file copying or server SSH needed after the push
</verification>

<success_criteria>
- Push to main deploys all three apps automatically
- helix.toto-castaldi.com serves landing page
- coach.helix.toto-castaldi.com serves coach app
- live.helix.toto-castaldi.com serves live tablet app
- All domains have valid HTTPS certificates
</success_criteria>

<output>
After completion, create `.planning/phases/15-deploy-pipeline/15-02-SUMMARY.md`
</output>
