---
phase: 06-template-management-ui
plan: 02
type: execute
wave: 2
depends_on: ["06-01"]
files_modified:
  - src/components/templates/index.ts
  - src/components/templates/TemplateManager.tsx
  - src/components/templates/TemplateList.tsx
  - src/components/templates/TemplateCard.tsx
  - src/components/templates/TemplateForm.tsx
  - src/components/templates/TemplateExerciseCard.tsx
  - src/pages/Sessions.tsx
autonomous: false

must_haves:
  truths:
    - "Coach can access template management from Sessions page header"
    - "Coach can see list of templates with exercise previews"
    - "Coach can create a new template with name"
    - "Coach can add exercises to a template with parameters"
    - "Coach can edit template name and exercise parameters"
    - "Coach can delete a template (if not in use)"
    - "Deletion shows error message if template is used by sessions"
  artifacts:
    - path: "src/components/templates/TemplateManager.tsx"
      provides: "Full-page template management overlay"
      min_lines: 100
    - path: "src/components/templates/TemplateForm.tsx"
      provides: "Template create/edit form"
      exports: ["TemplateForm"]
    - path: "src/components/templates/TemplateExerciseCard.tsx"
      provides: "Exercise card with parameters"
      min_lines: 80
    - path: "src/pages/Sessions.tsx"
      provides: "Template button in header"
      contains: "TemplateManager"
  key_links:
    - from: "src/pages/Sessions.tsx"
      to: "src/components/templates/TemplateManager.tsx"
      via: "state toggle and import"
      pattern: "showTemplateManager"
    - from: "src/components/templates/TemplateManager.tsx"
      to: "src/hooks/useGroupTemplates.ts"
      via: "hook import and usage"
      pattern: "useGroupTemplates"
---

<objective>
Create the template management UI: full-page overlay accessible from Sessions page, with list, cards, form, and exercise management.

Purpose: Coach can create, view, edit, and delete group templates from the main app
Output: Template management components and integration with Sessions page
</objective>

<execution_context>
@/home/toto/.claude/get-shit-done/workflows/execute-plan.md
@/home/toto/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/06-template-management-ui/06-01-SUMMARY.md
@.planning/phases/06-template-management-ui/06-CONTEXT.md
@.planning/phases/06-template-management-ui/06-RESEARCH.md

Key patterns to follow:
@src/components/sessions/ExercisePicker.tsx (full-page overlay pattern)
@src/components/sessions/SessionExerciseCard.tsx (exercise card with parameters)
@src/pages/Gyms.tsx (entity list page pattern)
@src/hooks/useEntityPage.ts (CRUD state management)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create template component files structure</name>
  <files>
    src/components/templates/index.ts
    src/components/templates/TemplateCard.tsx
    src/components/templates/TemplateExerciseCard.tsx
  </files>
  <action>
Create the templates component directory and foundation components.

**src/components/templates/index.ts:**
```typescript
export { TemplateManager } from './TemplateManager'
export { TemplateList } from './TemplateList'
export { TemplateCard } from './TemplateCard'
export { TemplateForm } from './TemplateForm'
export { TemplateExerciseCard } from './TemplateExerciseCard'
```

**src/components/templates/TemplateCard.tsx:**
Card showing template name and preview of first 2-3 exercises.
- Use Card, CardContent from @/components/ui/card
- Show template name as title
- Show first 3 exercise names in muted text
- CardActions for Edit/Delete buttons (from @/components/shared)
- Props: template, onEdit, onDelete

**src/components/templates/TemplateExerciseCard.tsx:**
Copy pattern from SessionExerciseCard but for template exercises:
- ChevronUp/ChevronDown for reorder
- Index number badge
- Exercise name (clickable to change via ExercisePicker)
- 2x2 grid of +/- steppers for sets, reps, weight_kg, duration_seconds
- Duration display (format seconds to "Xm Ys")
- Notes textarea
- Remove button (Trash2 icon)
- NO skipped toggle (templates don't have completion state)
- NO group toggle (all template exercises are group by definition)

Props: exercise, index, isFirst, isLast, catalogExercises, onRefreshExercises, onUpdate, onChangeExercise, onRemove, onMoveUp, onMoveDown
  </action>
  <verify>
```bash
ls -la /home/toto/scm-projects/helix/src/components/templates/
npm run build 2>&1 | grep -i "error" || echo "Build OK"
```
  </verify>
  <done>Template component structure created with TemplateCard and TemplateExerciseCard</done>
</task>

<task type="auto">
  <name>Task 2: Create TemplateForm and TemplateList</name>
  <files>
    src/components/templates/TemplateForm.tsx
    src/components/templates/TemplateList.tsx
  </files>
  <action>
**src/components/templates/TemplateForm.tsx:**
Form for template name with embedded exercise list.

Structure:
1. Input for template name (required)
2. List of TemplateExerciseCard components
3. "Aggiungi Esercizio" button opens ExercisePicker
4. FormActions (Save/Cancel)

Props:
- template?: GroupTemplateWithExercises (for edit mode)
- catalogExercises: ExerciseWithDetails[]
- onRefreshExercises?: () => void
- onSubmit: (name, exercises) => Promise<void>
- onCancel: () => void
- isSubmitting: boolean

State:
- name: string (controlled input)
- exercises: local array of exercise objects with params
- showPicker: boolean

Handlers for TemplateExerciseCard:
- onMoveUp: (index) => reorder local exercises array (swap with index-1)
- onMoveDown: (index) => reorder local exercises array (swap with index+1)
- onUpdate: (index, params) => update exercise params in local array
- onChangeExercise: (index, newExercise) => replace exercise at index
- onRemove: (index) => remove exercise from local array

The reorder happens locally in state - no DB persistence until form submit.
When saving, parent (TemplateManager) handles actual API calls including hook's reorderExercises for DB persistence.

When adding exercise from picker:
- Add to local exercises array with default params (null for all)

When saving:
- Call onSubmit with name and exercises array
- Parent handles actual API calls

**src/components/templates/TemplateList.tsx:**
List of TemplateCard components.

Props:
- templates: GroupTemplateWithExercises[]
- onEdit: (template) => void
- onDelete: (template) => void

Renders vertical list of TemplateCard, or EmptyState if no templates.
  </action>
  <verify>
```bash
npm run build 2>&1 | grep -i "error" || echo "Build OK"
```
  </verify>
  <done>TemplateForm and TemplateList components created with proper props and structure</done>
</task>

<task type="auto">
  <name>Task 3: Create TemplateManager and integrate with Sessions</name>
  <files>
    src/components/templates/TemplateManager.tsx
    src/pages/Sessions.tsx
  </files>
  <action>
**src/components/templates/TemplateManager.tsx:**
Full-page overlay for template management (like ExercisePicker).

Structure:
```tsx
<div className="fixed inset-0 z-50 bg-background flex flex-col">
  {/* Header with title and close button */}
  <div className="flex items-center justify-between p-4 border-b">
    <h1 className="text-lg font-semibold">Template di Gruppo</h1>
    <Button variant="ghost" size="icon" onClick={onClose}>
      <X className="h-5 w-5" />
    </Button>
  </div>

  {/* Content area */}
  <div className="flex-1 overflow-y-auto p-4">
    {/* PageHeader with "Nuovo" button when not showing form */}
    {/* FormCard with TemplateForm when creating/editing */}
    {/* DeleteConfirmDialog when deleting */}
    {/* TemplateList when viewing */}
  </div>
</div>
```

Use useGroupTemplates hook for data operations.
Use useEntityPage for CRUD state management.
Use useExercises for exercise catalog.

Delete handling:
- Call deleteTemplate from hook
- If returns false (template in use), hook sets error
- Show error using ErrorAlert component

Props:
- onClose: () => void

**src/pages/Sessions.tsx:**
Add Template button to PageHeader (next to Live and Nuova buttons).

Changes:
1. Add import: `import { TemplateManager } from '@/components/templates'`
2. Add state: `const [showTemplateManager, setShowTemplateManager] = useState(false)`
3. Add button in PageHeader (before Live button):
```tsx
<Button size="sm" variant="outline" onClick={() => setShowTemplateManager(true)}>
  <LayoutTemplate className="h-4 w-4 mr-2" />
  Template
</Button>
```
4. Add icon import: `import { LayoutTemplate } from 'lucide-react'`
5. Render TemplateManager when showTemplateManager is true:
```tsx
{showTemplateManager && (
  <TemplateManager onClose={() => setShowTemplateManager(false)} />
)}
```
  </action>
  <verify>
```bash
npm run build 2>&1 | grep -i "error" || echo "Build OK"
```
  </verify>
  <done>TemplateManager integrated with Sessions page, accessible via Template button</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Template management UI with full CRUD operations</what-built>
  <how-to-verify>
1. Start dev server: `npm run dev`
2. Navigate to Sessions page
3. Click "Template" button in header
4. Verify TemplateManager overlay opens
5. Create a new template:
   - Click "Nuovo"
   - Enter a name
   - Add 2-3 exercises
   - Set some parameters (sets, reps)
   - Save
6. Verify template appears in list with exercise preview
7. Edit the template:
   - Click edit icon
   - Change name
   - Reorder exercises
   - Save
8. Delete the template:
   - Click delete icon
   - Confirm deletion
   - Verify it's removed
  </how-to-verify>
  <resume-signal>Type "approved" if template CRUD works, or describe issues</resume-signal>
</task>

</tasks>

<verification>
1. TypeScript compiles: `npm run build`
2. Template button visible in Sessions page header
3. TemplateManager opens as full-page overlay
4. Can create, edit, delete templates
5. Exercise cards have all parameter controls
</verification>

<success_criteria>
- Template button in Sessions page header opens TemplateManager
- TemplateManager shows list of templates with exercise previews
- Can create new template with name and exercises
- Can edit template name and exercise parameters
- Can reorder exercises with up/down buttons
- Can delete template (shows error if in use)
- All operations save to database via useGroupTemplates hook
</success_criteria>

<output>
After completion, create `.planning/phases/06-template-management-ui/06-02-SUMMARY.md`
</output>
