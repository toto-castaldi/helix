---
phase: 08-client-view-separation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - package.json
  - src/shared/components/ui/tabs.tsx
  - src/shared/hooks/useLiveCoaching.ts
  - src/live/components/ClientExerciseView.tsx
  - src/live/pages/TabletLive.tsx
autonomous: true

must_haves:
  truths:
    - "Client view in tablet shows two tabs: 'I miei' and 'Gruppo'"
    - "Tab 'I miei' displays only individual exercises (is_group=false)"
    - "Tab 'Gruppo' displays only group exercises (is_group=true)"
    - "Exercises move between tabs instantly when is_group changes via realtime"
    - "Both tabs show exercise count badges"
  artifacts:
    - path: "src/shared/components/ui/tabs.tsx"
      provides: "Shadcn/ui tabs component"
      contains: "TabsContent"
    - path: "src/live/components/ClientExerciseView.tsx"
      provides: "Client view with tabs filtering exercises by is_group"
      exports: ["ClientExerciseView"]
      min_lines: 50
    - path: "src/shared/hooks/useLiveCoaching.ts"
      provides: "Realtime sync that updates is_group field"
      contains: "is_group: updated.is_group"
  key_links:
    - from: "src/live/components/ClientExerciseView.tsx"
      to: "src/shared/components/ui/tabs.tsx"
      via: "import Tabs, TabsList, TabsTrigger, TabsContent"
      pattern: "import.*Tabs.*from"
    - from: "src/live/pages/TabletLive.tsx"
      to: "src/live/components/ClientExerciseView.tsx"
      via: "render ClientExerciseView when viewMode is individual"
      pattern: "ClientExerciseView"
---

<objective>
Implement client view separation in the tablet live coaching app with two tabs ("I miei" for individual exercises, "Gruppo" for group exercises).

Purpose: During live sessions, clients can see their exercises organized by type - personal exercises separate from group exercises.
Output: ClientExerciseView component with tabs, integrated into TabletLive.tsx
</objective>

<execution_context>
@/home/toto/.claude/get-shit-done/workflows/execute-plan.md
@/home/toto/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/08-client-view-separation/08-RESEARCH.md
@src/live/pages/TabletLive.tsx
@src/live/components/ExerciseCarousel.tsx
@src/shared/hooks/useLiveCoaching.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add shadcn/ui tabs component and fix realtime subscription</name>
  <files>
    package.json
    src/shared/components/ui/tabs.tsx
    src/shared/hooks/useLiveCoaching.ts
  </files>
  <action>
1. Add the shadcn/ui tabs component:
   ```bash
   npx shadcn@latest add tabs
   ```
   This installs @radix-ui/react-tabs and creates src/shared/components/ui/tabs.tsx

2. Fix the realtime subscription in useLiveCoaching.ts to include is_group field.
   At line ~792, the UPDATE handler currently updates only: completed, skipped, completed_at
   Add `is_group: updated.is_group` to the spread:
   ```typescript
   ex.id === updated.id
     ? { ...ex, completed: updated.completed, skipped: updated.skipped,
         completed_at: updated.completed_at, is_group: updated.is_group }
     : ex
   ```
   This ensures exercises move between tabs instantly when is_group changes.
  </action>
  <verify>
    - File src/shared/components/ui/tabs.tsx exists with Tabs, TabsList, TabsTrigger, TabsContent exports
    - useLiveCoaching.ts line ~792 includes `is_group: updated.is_group`
    - npm run build succeeds
  </verify>
  <done>
    - Tabs component available in shared/components/ui
    - Realtime subscription updates is_group field for instant tab moves
  </done>
</task>

<task type="auto">
  <name>Task 2: Create ClientExerciseView component with tabs</name>
  <files>src/live/components/ClientExerciseView.tsx</files>
  <action>
Create a new component that wraps exercises in a tabbed view:

1. Import dependencies:
   - Tabs, TabsContent, TabsList, TabsTrigger from '@/shared/components/ui/tabs'
   - useMemo from React
   - Badge from '@/shared/components/ui/badge' (for counts)
   - Users from 'lucide-react' (for group tab icon)
   - ExerciseCarousel (or inline exercise rendering)
   - SessionWithDetails type

2. Props interface:
   ```typescript
   interface ClientExerciseViewProps {
     session: SessionWithDetails
     onSelectExercise: (index: number) => void
     onUpdateExercise: (field: string, value: number | string | null) => void
   }
   ```

3. Filter exercises using useMemo:
   ```typescript
   const { individualExercises, groupExercises, individualIndices, groupIndices } = useMemo(() => {
     const exercises = session.exercises || []
     const individual: SessionExercise[] = []
     const group: SessionExercise[] = []
     const indivIdx: number[] = []
     const grpIdx: number[] = []

     exercises.forEach((ex, idx) => {
       if (ex.is_group) {
         group.push(ex)
         grpIdx.push(idx)
       } else {
         individual.push(ex)
         indivIdx.push(idx)
       }
     })

     return {
       individualExercises: individual,
       groupExercises: group,
       individualIndices: indivIdx,
       groupIndices: grpIdx,
     }
   }, [session.exercises])
   ```

4. Tab styling (match dark theme from TabletLive):
   - TabsList: bg-gray-800 border border-gray-700
   - TabsTrigger: data-[state=active]:bg-primary data-[state=active]:text-white text-gray-300
   - Badges: variant="secondary" with counts

5. Tab content:
   - "I miei" tab: Render individual exercises using simplified ExerciseCard list (not carousel)
     - Client view is read-only or simplified - consider just showing exercise cards in a scrollable list
     - Map back to original indices when calling onSelectExercise
   - "Gruppo" tab: Same pattern for group exercises

6. Empty states:
   - "Nessun esercizio individuale" for empty "I miei" tab
   - "Nessun esercizio di gruppo" for empty "Gruppo" tab
   - Use existing empty state pattern from GroupExerciseView

7. Layout:
   - Use flex-1 flex flex-col min-h-0 pattern for proper height management
   - TabsContent should be scrollable (overflow-auto)

NOTE: Since client view may be different from coach carousel view, consider whether to reuse ExerciseCarousel
or create a simpler list of ExerciseCards. The client typically just views their exercises, doesn't need
the full carousel interaction. A scrollable list of cards may be more appropriate.
  </action>
  <verify>
    - File exists with exports: ClientExerciseView
    - Component accepts session, onSelectExercise, onUpdateExercise props
    - useMemo filters exercises by is_group
    - Both tabs render with count badges
    - Empty states handled for both tabs
  </verify>
  <done>
    - ClientExerciseView component filters and displays exercises in two tabs
    - Exercise counts shown as badges on tab triggers
    - Empty states provide helpful messages
  </done>
</task>

<task type="auto">
  <name>Task 3: Integrate ClientExerciseView into TabletLive</name>
  <files>src/live/pages/TabletLive.tsx</files>
  <action>
Update TabletLive.tsx to use ClientExerciseView:

1. Import ClientExerciseView:
   ```typescript
   import { ClientExerciseView } from '@/live/components/ClientExerciseView'
   ```

2. In the viewMode === 'individual' section (lines ~254-279), replace the ExerciseCarousel
   with ClientExerciseView:
   ```tsx
   {viewMode === 'individual' ? (
     <>
       <ActionPanel ... />
       <div className="flex-1 min-h-0">
         {selectedSession && (
           <ClientExerciseView
             session={selectedSession}
             onSelectExercise={handleExerciseSelect}
             onUpdateExercise={handleUpdateExercise}
           />
         )}
       </div>
     </>
   ) : (
     <GroupExerciseView ... />
   )}
   ```

3. Ensure the container div has proper flex layout (flex-1 min-h-0) for height management.

4. Remove ExerciseCarousel import if no longer used directly in TabletLive.
  </action>
  <verify>
    - TabletLive.tsx imports and renders ClientExerciseView
    - When viewMode is 'individual', two tabs appear: "I miei" and "Gruppo"
    - Tabs filter exercises correctly by is_group flag
    - npm run build succeeds
    - npm run dev:live starts without errors
  </verify>
  <done>
    - Client view in tablet shows tabbed exercise list
    - Individual exercises in "I miei" tab
    - Group exercises in "Gruppo" tab
    - ActionPanel still available for exercise operations
  </done>
</task>

</tasks>

<verification>
After all tasks complete:

1. **Build verification:**
   ```bash
   npm run build:live
   ```
   Must complete without errors.

2. **Visual verification (manual):**
   - Start dev server: `npm run dev:live`
   - Navigate to a session with both individual and group exercises
   - Verify two tabs appear in client view: "I miei" and "Gruppo"
   - Verify exercise counts shown on tabs
   - Verify exercises filter correctly into each tab
   - Verify empty states appear when a tab has no exercises

3. **Realtime verification:**
   - In another tab/window, change an exercise's is_group flag
   - Verify exercise moves to other tab instantly (no page refresh)
</verification>

<success_criteria>
- Client view in tablet has two tabs: "I miei" and "Gruppo"
- "I miei" tab shows only individual exercises (is_group=false)
- "Gruppo" tab shows only group exercises (is_group=true)
- Exercise counts displayed as badges on tab triggers
- Exercises move between tabs instantly when is_group changes via realtime
- Empty states shown when a tab has no exercises
- Build completes without errors
</success_criteria>

<output>
After completion, create `.planning/phases/08-client-view-separation/08-01-SUMMARY.md`
</output>
