# Milestone v1.1: Group Exercise Improvements

**Status:** SHIPPED 2026-02-02
**Phases:** 5-9
**Total Plans:** 10

## Overview

5 phases to deliver group exercise templates, client view separation in tablet, and mobile cleanup. Phase numbering continues from v1.0 (which ended at Phase 4).

## Phases

### Phase 5: Template Database Schema

**Goal**: Database foundation for reusable group exercise templates
**Depends on**: Phase 4 (v1.0 complete)
**Plans**: 1 plan

Plans:
- [x] 05-01: Create migration with tables, RLS, indexes; add TypeScript types; update CLAUDE.md

**Details:**
- Table `group_templates` with name, user_id, timestamps
- Table `group_template_exercises` with exercise_id, parameters, order_index
- RLS policies (8 total) enforcing coach isolation
- TypeScript types: GroupTemplate, GroupTemplateExercise, etc.

---

### Phase 6: Template Management UI

**Goal**: Coach can create, edit, delete, and apply group templates
**Depends on**: Phase 5
**Plans**: 3 plans

Plans:
- [x] 06-01: Schema migration for template_id + useGroupTemplates hook
- [x] 06-02: Template management UI components and Sessions integration
- [x] 06-03: Apply template to session with linked behavior

**Details:**
- Full-page overlay template management (TemplateManager)
- Template CRUD with exercise parameter editing
- ApplyTemplateDialog with Add/Replace mode
- Edit blocking for template-linked exercises

---

### Phase 7: MCP Template Integration

**Goal**: Templates accessible via MCP for AI-assisted planning
**Depends on**: Phase 5
**Plans**: 3 plans

Plans:
- [x] 07-01: Add MCP resources for group templates (list + detail)
- [x] 07-02: Add MCP template CRUD tools (create, update, delete)
- [x] 07-03: Add MCP exercise tools, apply tool, and prompts

**Details:**
- 2 new resources: helix://group-templates, helix://group-templates/{id}
- 6 new tools: create, update, delete template; add/remove exercise; apply to session
- 2 enhanced prompts: plan-session (template suggestions), template-analysis

---

### Phase 8: Client View Separation

**Goal**: Tablet client view separates individual and group exercises
**Depends on**: Phase 4 (v1.0 live tablet)
**Plans**: 1 plan

Plans:
- [x] 08-01: Add tabs component, fix realtime sync, create ClientExerciseView with tabs

**Details:**
- Tabs component (shadcn/ui with @radix-ui/react-tabs)
- ClientExerciseView with "I miei" and "Gruppo" tabs
- Realtime sync for is_group field
- Index mapping for proper exercise selection

---

### Phase 9: Mobile Cleanup + Bugfix

**Goal**: Remove Live from mobile app and fix export bug
**Depends on**: None (independent)
**Plans**: 2 plans

Plans:
- [x] 09-01: Remove Live page, route, and button from main mobile app
- [x] 09-02: Investigate and fix client export bug

**Details:**
- Removed /live route and Live button from Sessions
- Deleted 6 unused component files (LiveDashboard, etc.)
- Fixed 401 error using refreshSession() for JWT refresh

---

## Milestone Summary

**Key Decisions:**
- ON DELETE RESTRICT on template_id FK to block template deletion when in use
- Partial index for template_id (WHERE NOT NULL) for efficient lookups
- Template exercises linked via template_id (not copied independently)
- Edit blocking in session view for template-linked exercises
- mode parameter required for apply_template_to_session (no default)
- Tab filtering with index mapping for proper exercise selection
- refreshSession() instead of getSession() for authenticated Edge Function calls

**Issues Resolved:**
- Client export 401 Unauthorized (stale JWT token)
- Tablet app Live-specific code isolated from mobile app

**Issues Deferred:**
None

**Technical Debt Incurred:**
- Minor: UI uses 'add' mode, MCP uses 'append' â€” consider standardizing in future
- By design: Template edits don't cascade to existing sessions

---

*For current project status, see .planning/ROADMAP.md*
